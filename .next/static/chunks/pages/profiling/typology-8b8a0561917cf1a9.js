(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[767],{3:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/profiling/typology",function(){return s(6740)}])},6740:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return l}});var r=s(5893),o=s(7294),n=s(1163),a=s(1664),i=s.n(a);function l(){const e=(0,n.useRouter)(),[t,s]=(0,o.useState)(0),[a,l]=(0,o.useState)({}),[c,d]=(0,o.useState)(!1),[h,m]=(0,o.useState)([]),[g,p]=(0,o.useState)(0);(0,o.useEffect)((()=>{x(),u()}),[]),(0,o.useEffect)((()=>{b()}),[a,t]);const x=async()=>{try{const t=await fetch("/api/profiling/typology/items"),s=await t.json();var e;if(s.success)m(s.questions||[]),console.log("\u2705 \u0412\u043e\u043f\u0440\u043e\u0441\u044b \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d\u044b \u0443\u0441\u043f\u0435\u0448\u043d\u043e:",null===(e=s.questions)||void 0===e?void 0:e.length);else console.error("\u274c API \u0432\u0435\u0440\u043d\u0443\u043b \u043e\u0448\u0438\u0431\u043a\u0443:",s.error),m([])}catch(t){console.error("\u274c \u041e\u0448\u0438\u0431\u043a\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u0432\u043e\u043f\u0440\u043e\u0441\u043e\u0432:",t),m([])}},u=()=>{{const t=localStorage.getItem("benehab_typology_answers");if(t)try{const e=JSON.parse(t);l(e)}catch(e){console.error("\u041e\u0448\u0438\u0431\u043a\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u043f\u0440\u043e\u0433\u0440\u0435\u0441\u0441\u0430:",e)}}},b=()=>{const e=h.length;if(e>0){p((t+1)/e*100)}},y=(e,t,s)=>{const r=a[e]||[];if(r.some((e=>e.optionId===t))){const s=r.filter((e=>e.optionId!==t));l((t=>({...t,[e]:s})))}else{if(r.length>=3)return;const o=[...r,{optionId:t,ptype:s}];l((t=>({...t,[e]:o})))}localStorage.setItem("benehab_typology_answers",JSON.stringify(a))},f=()=>{var e;return(a[null===(e=h[t])||void 0===e?void 0:e.id]||[]).length>=1},N=()=>t>0,j=e=>(a[e]||[]).length,w=(e,t)=>(a[e]||[]).some((e=>e.optionId===t)),_=(e,t)=>{const s=j(e),r=w(e,t);return s>=3&&!r},v=async()=>{try{const e=await fetch("/api/profiling/pib",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({demographics:JSON.parse(localStorage.getItem("benehab_demographics")||"{}"),attitude_profile:JSON.parse(localStorage.getItem("benehab_attitude_profile")||"{}"),typology_profile:JSON.parse(localStorage.getItem("benehab_typology_profile")||"{}")})});if(e.ok){const t=await e.json();localStorage.setItem("benehab.pib",JSON.stringify(t.pib))}}catch(e){console.error("\u041e\u0448\u0438\u0431\u043a\u0430 \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u0438 PIB:",e)}};if(0===h.length)return(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-emerald-600 mx-auto mb-4"}),(0,r.jsx)("p",{children:"\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043c \u0432\u043e\u043f\u0440\u043e\u0441\u044b..."})]})});const S=h[t];return(0,r.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto p-4",children:[(0,r.jsxs)("div",{className:"bg-white rounded-2xl p-6 mb-6 shadow-sm",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:"\u041e\u043f\u0440\u043e\u0441: \u0421\u0442\u0438\u043b\u044c \u043e\u0431\u0449\u0435\u043d\u0438\u044f"}),(0,r.jsx)(i(),{href:"/",className:"text-emerald-600 hover:text-emerald-700",children:"\u0412\u0435\u0440\u043d\u0443\u0442\u044c\u0441\u044f \u043a \u0447\u0430\u0442\u0443"})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("div",{className:"flex justify-between text-sm text-gray-600 mb-2",children:[(0,r.jsxs)("span",{children:["\u041f\u0440\u043e\u0433\u0440\u0435\u0441\u0441: ",Math.round(g),"%"]}),(0,r.jsxs)("span",{children:["\u0412\u043e\u043f\u0440\u043e\u0441 ",t+1," \u0438\u0437 ",h.length]})]}),(0,r.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,r.jsx)("div",{className:"bg-emerald-600 h-2 rounded-full transition-all duration-300",style:{width:"".concat(g,"%")}})})]}),(0,r.jsx)("p",{className:"text-gray-700",children:'\u041e\u0442\u043c\u0435\u0442\u044c\u0442\u0435 \u043e\u0442 1 \u0434\u043e 3 \u0443\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u0438\u0439, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043e\u0442\u043d\u043e\u0441\u044f\u0442\u0441\u044f \u043a \u0432\u0430\u043c. \u041d\u0435\u0442 "\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u044b\u0445" \u0438\u043b\u0438 "\u043d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u044b\u0445" \u043e\u0442\u0432\u0435\u0442\u043e\u0432 \u2014 \u044d\u0442\u043e \u043f\u0440\u043e\u0441\u0442\u043e \u043f\u0440\u043e \u0432\u0430\u0448 \u0441\u0442\u0438\u043b\u044c \u043e\u0431\u0449\u0435\u043d\u0438\u044f \u0438 \u0432\u043e\u0441\u043f\u0440\u0438\u044f\u0442\u0438\u044f \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0438.'})]}),S&&(0,r.jsxs)("div",{className:"bg-white rounded-2xl p-6 mb-6 shadow-sm",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:S.question_text}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:S.options.map((e=>(0,r.jsxs)("label",{className:"\n                    flex items-start cursor-pointer p-4 rounded-lg border-2 transition-all\n                    ".concat(w(S.id,e.option_id)?"border-emerald-500 bg-emerald-50":"border-gray-200 hover:border-gray-300","\n                    ").concat(_(S.id,e.option_id)?"opacity-50 cursor-not-allowed":"","\n                  "),children:[(0,r.jsx)("input",{type:"checkbox",checked:w(S.id,e.option_id),onChange:()=>y(S.id,e.option_id,e.ptype),disabled:_(S.id,e.option_id),className:"mt-1 h-4 w-4 text-emerald-600 border-gray-300 rounded focus:ring-emerald-500"}),(0,r.jsx)("span",{className:"ml-3 text-sm text-gray-700 leading-relaxed",children:e.option_text})]},e.option_id)))}),(0,r.jsxs)("div",{className:"mt-4 text-sm text-gray-500 text-center",children:["\u0412\u044b\u0431\u0440\u0430\u043d\u043e: ",j(S.id)," \u0438\u0437 3"]})]}),(0,r.jsx)("div",{className:"bg-white rounded-2xl p-6 shadow-sm",children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("button",{onClick:()=>{N()&&s((e=>e-1))},disabled:!N(),className:"\n                px-6 py-2 rounded-xl transition-colors\n                ".concat(N()?"border border-gray-300 text-gray-700 hover:border-emerald-400 hover:text-emerald-600":"border border-gray-200 text-gray-400 cursor-not-allowed","\n              "),children:"\u2190 \u041d\u0430\u0437\u0430\u0434"}),t<h.length-1?(0,r.jsx)("button",{onClick:()=>{f()&&t<h.length-1&&s((e=>e+1))},disabled:!f(),className:"\n                  px-6 py-2 rounded-xl transition-colors\n                  ".concat(f()?"bg-emerald-600 text-white hover:bg-emerald-700":"bg-gray-300 text-gray-500 cursor-not-allowed","\n                "),children:"\u0414\u0430\u043b\u0435\u0435 \u2192"}):(0,r.jsx)("button",{onClick:async()=>{if(f()){d(!0);try{const t=await fetch("/api/profiling/typology/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({answers:a})});if(t.ok){const s=await t.json();localStorage.setItem("benehab_typology_profile",JSON.stringify(s.profile)),await v(),e.push("/")}else console.error("\u041e\u0448\u0438\u0431\u043a\u0430 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438 \u043e\u0442\u0432\u0435\u0442\u043e\u0432")}catch(t){console.error("\u041e\u0448\u0438\u0431\u043a\u0430 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438 \u043e\u0442\u0432\u0435\u0442\u043e\u0432:",t)}finally{d(!1)}}},disabled:!f()||c,className:"\n                  px-6 py-2 rounded-xl transition-colors\n                  ".concat(f()&&!c?"bg-emerald-600 text-white hover:bg-emerald-700":"bg-gray-300 text-gray-500 cursor-not-allowed","\n                "),children:c?"\u0417\u0430\u0432\u0435\u0440\u0448\u0430\u0435\u043c...":"\u0417\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u043e\u043f\u0440\u043e\u0441"})]})}),(0,r.jsx)("div",{className:"text-center text-sm text-gray-500 mt-4",children:"\u0412\u0430\u0448\u0438 \u043e\u0442\u0432\u0435\u0442\u044b \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u044e\u0442\u0441\u044f. \u041f\u043e\u0441\u043b\u0435 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u044f \u0432\u044b \u0441\u043c\u043e\u0436\u0435\u0442\u0435 \u043e\u0431\u0449\u0430\u0442\u044c\u0441\u044f \u0441 \u0422\u0430\u0442\u044c\u044f\u043d\u043e\u0439 \u0432 \u043f\u0435\u0440\u0441\u043e\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u043e\u043c \u0440\u0435\u0436\u0438\u043c\u0435."})]})})}},1163:function(e,t,s){e.exports=s(9974)}},function(e){e.O(0,[664,774,888,179],(function(){return t=3,e(e.s=t);var t}));var t=e.O();_N_E=t}]);