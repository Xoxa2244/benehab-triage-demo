// Инструкции по коммуникации для агента на основе профилирования пациента
// Источник: Solomin Methodology - ТОБОЛ профилирование

export const communicationInstructions = {
  // Инструкции по Attitude профилю (1 этап)
  attitude: {
    severity: {
      name: "Страдающий",
      description: "Субъективная оценка тяжести заболевания, которая коррелирует с убеждением в неизлечимости и суицидальными мыслями",
      communication_challenges: [
        "Физические страдания",
        "Большой объем жалоб", 
        "Плохое самочувствие (подавленность, низкая энергия, раздражительность)"
      ],
      positive_scenario: [
        "Начинать коммуникацию с объяснения того, что будет происходить",
        "Сообщить о готовности выслушать жалобы и назначить все необходимые исследования",
        "Обсудить возможные варианты действий, убедиться что пациент понял и согласен с планом",
        "Побуждать пациента вести дневник симптомов для отслеживания изменений"
      ],
      extreme_actions: {
        low: "Низкие значения (0-2): Низкая оценка серьезности заболевания - увеличить частоту взаимодействия на 20%, увеличить количество разъяснительных мероприятий",
        high: "Высокие значения (10-16): Уверенность в бессмысленности лечения или скрытое желание покончить с собой - направить на консультацию с психотерапевтом"
      },
      negative_scenario: [
        "Не обесценивать объем симптомов, даже если они кажутся надуманными и незначительными"
      ]
    },

    secondary_gain: {
      name: "Прагматический", 
      description: "Вторичная выгода заболевания",
      communication_challenges: [
        "Болезнь приносит выгоду пациенту: забота близких, избегание ответственности",
        "Демонстративность симптомов, возможно преувеличение",
        "Средний уровень активности в отношении лечения",
        "Избыточная выгода от болезни может побуждать к избеганию сотрудничества"
      ],
      positive_scenario: [
        "Последовательность и ясность позиции медперсонала",
        "Баланс поддержки и возвращения ответственности пациенту",
        "Побуждать пациента вести дневник симптомов"
      ],
      extreme_actions: {
        low: "Низкие значения: -",
        high: "Высокие значения (4-8): Потеря преимущества, которое болезнь предоставляет - направление на консультацию с психотерапевтом"
      },
      negative_scenario: [
        "Не давать гипер заботу",
        "Не говорить намеками и двойными посланиями"
      ]
    },

    hide_resist: {
      name: "Скрывающий",
      description: "Стремление скрыть свою болезнь и сопротивление болезни",
      communication_challenges: [
        "Слишком низкие значения - недостаток желания бороться с болезнью",
        "Слишком высокие - чувство стыда за болезнь, нежелание жаловаться",
        "Много страхов: осуждение, потеря соц статуса, фин расходы",
        "С трудом идут на диалог, могут пропускать визиты"
      ],
      positive_scenario: [
        "Валидация проблемы и поддержка",
        "Рассказать об опыте врача в лечении данного заболевания", 
        "Рассказать о важности выявления проблем на ранней стадии",
        "Дать время на принятие своей болезни",
        "Поощрять регулярность посещения встреч"
      ],
      extreme_actions: {
        low: "Низкие значения (0-3): Недостаточно упорное стремление к выздоровлению - увеличить частоту взаимодействия на 20%, дать больше поддержки",
        high: "Высокие значения (8-10): Стремление замаскировать симптомы - необходимо исследование мотивационной сферы через психотерапию"
      },
      negative_scenario: [
        "Не давить, когда пациент сопротивляется давать информацию о себе"
      ]
    },

    work_escape: {
      name: "Деятельный",
      description: "Стремление «убежать» в работу или спорт",
      communication_challenges: [
        "Низкий уровень сотрудничества, много сопротивления",
        "Неактивен в отношении лечения",
        "Часто испытывает чувство стыда из-за болезни",
        "Работа гораздо важнее здоровья, погружается с головой в работу"
      ],
      positive_scenario: [
        "Дозированное преподнесение информации о болезни",
        "Признание важности сохранения соц статуса",
        "Хвалить даже за минимальное выполнение назначений",
        "Фокусировка на ценности здоровья как основы сохранения работоспособности"
      ],
      extreme_actions: {
        low: "Низкие значения: -",
        high: "Высокие значения (8-10): Трудоголизм, зависимость от работы - увеличить частоту взаимодействия на 20%, давать больше эмпатии"
      },
      negative_scenario: [
        "Не пытаться доказать пациенту, что он не прав"
      ]
    },

    low_selfesteem: {
      name: "Сниженная самооценка",
      description: "Сниженная самооценка, неудовлетворенность собой, склонность к депрессии",
      communication_challenges: [
        "Используем базовый сценарий коммуникации"
      ],
      positive_scenario: [
        "Базовый сценарий коммуникации"
      ],
      extreme_actions: {
        low: "Низкие значения (-2-0): Чрезмерная самоуверенность - увеличить частоту встреч 20%, чуть больше контроля",
        high: "Высокие значения (3-6): Дефицит мотивации - увеличить частоту взаимодействия на 20%, дать больше поддержки"
      },
      negative_scenario: []
    },

    alt_med: {
      name: "Недоверчивый",
      description: "Вера в альтернативную медицину и стремление к самолечению",
      communication_challenges: [
        "Низкий уровень сотрудничества",
        "Могут обследоваться, но назначения не выполнять",
        "Могут иметь негативный опыт лечения",
        "Очень много информации черпают из интернета"
      ],
      positive_scenario: [
        "Признавать право выбирать способ лечения",
        "Давать дозированную информацию об опыте клиники, врача",
        "Приглашать в совместное составление плана лечения"
      ],
      extreme_actions: {
        low: "Низкие значения: -",
        high: "Высокие значения (6-12): Недоверие к оф медицине - продолжать работу на выстраивание безопасных отношений"
      },
      negative_scenario: [
        "Не критиковать выбор пациента, не называть это эффектом плацебо"
      ]
    },

    addictions: {
      name: "Химические зависимости",
      description: "Вредные привычки, химические зависимости, аддикции",
      communication_challenges: [
        "Используем базовый сценарий коммуникации"
      ],
      positive_scenario: [
        "Базовый сценарий коммуникации"
      ],
      extreme_actions: {
        low: "Низкие значения: -",
        high: "Высокие значения (-2-6): Зависимость - рекомендация консультации нарколога"
      },
      negative_scenario: []
    },

    ignore: {
      name: "Игнорирующий",
      description: "Игнорирование болезни",
      communication_challenges: [
        "Отбрасывает мысли о болезни, отрицает заболевание",
        "Игнорирует рекомендации медперсонала",
        "Неактивны в отношении лечения",
        "Испытывают напряжение от необходимости перестроить ценности"
      ],
      positive_scenario: [
        "Тактично уточнять хочет ли пациент больше узнать",
        "Признавать важность жить полной жизнью и еще большей важности заниматься здоровьем",
        "Хвалить за выполнение рекомендаций",
        "Фокусировать внимание на симптомах, а не диагнозе"
      ],
      extreme_actions: {
        low: "Низкие значения: -",
        high: "Высокие значения (4-6): Беспечное отношение к здоровью - увеличить частоту взаимодействия на 20%, увеличить количество разъяснительных мероприятий"
      },
      negative_scenario: [
        "Не давить на пациента",
        "Избегать конфронтаций с пациентом"
      ]
    },

    anxiety: {
      name: "Тревожный",
      description: "Склонность к тревожным расстройствам",
      communication_challenges: [
        "Используем базовый сценарий коммуникации"
      ],
      positive_scenario: [
        "Базовый сценарий коммуникации"
      ],
      extreme_actions: {
        low: "Низкие значения: -",
        high: "Высокие значения (3-6): Переоценка вероятности негативных событий - рекомендации консультации психотерапевта"
      },
      negative_scenario: []
    }
  },

  // Инструкции по Typology профилю (2 этап)
  typology: {
    sensitive: {
      name: "Чувствительный",
      description: "Вы хорошо чувствуете даже слабые сигналы вашего организма. Вы можете быстро уставать и от этого становиться раздражительным.",
      promise: "Я помогу вам научиться качественно отдыхать и расслабляться и снижать таким образом уровень стресса и раздражения",
      characteristics: [
        "Повышенной чувствительностью, утомляемостью, озабоченностью своим состоянием, раздражительностью",
        "Ипохондричны"
      ],
      possible_actions: "Могут раздражаться на медперсонал",
      stress_factor: "Интенсивная нагрузка: физическая/эмоциональная",
      stress_reaction: "Уход в болезнь, как способ отдохнуть",
      illness_perception: "Средство повышения работоспособности, выносливости и избавления от страданий",
      treatment_perception: "В отдыхе, релаксации, стабильном режиме дня",
      voice_type: "Спокойный, медленный, поддерживающий",
      interaction_frequency: "Средняя",
      positive_communication: [
        "Структурированная и дозированная информация с регулярной сверкой готовности пациента",
        "Постоянная поддержка и эмпатия",
        "Хвалить даже за самые маленькие достижения",
        "Фокусировка на плане лечения и наступлении эффекта",
        "Мотивировать через фразы о выполнении плана"
      ],
      negative_communication: [
        "Не перегружать информацией и действиями (не более 2х действий после встречи)",
        "Избегать резких и категоричных и критичных высказываний",
        "Не обесценивать симптомы и переживания пациента",
        "Не запугивать и не давить"
      ]
    },

    dysthymic: {
      name: "Подавленный",
      description: "Вы достаточно ответственны и можете предъявлять к себе повышенные требования. И это может негативно сказываться на вашем настроении.",
      promise: "Вы не одни на этом пути. Я поддержу вас, и помогу вам разобраться с тем, что вызывает напряжение и найти светлые моменты даже в сложных ситуациях.",
      characteristics: [
        "Подавленным настроением, сниженным уровнем побуждений, ограничением интересов",
        "Пессимистической оценкой перспектив, повышенной требовательностью к себе",
        "Недооценкой своей значимости"
      ],
      possible_actions: "Могут стремиться быть хорошими в ожидании теплого отношения к себе",
      stress_factor: "Ошибки, неудачи, разрыв привязанностей",
      stress_reaction: "Аутоагрессия (ругает себя и обвиняет себя), которая усиливает соматизацию",
      illness_perception: "Источник вины и наказание",
      treatment_perception: "Выполнение обязанности и долг перед близкими",
      voice_type: "Спокойный, мягкий, поддерживающий",
      interaction_frequency: "Средняя",
      positive_communication: [
        "Информация должна быть очень простой и дозированной",
        "Показать заинтересованность в понимании пациента",
        "Отмечать и позитивно подкреплять любые даже самые маленькие сдвиги",
        "Фокусировка на маленьких шагах",
        "Мотивировать через подсвечивание рисков и преимуществ"
      ],
      negative_communication: [
        "Не пытаться доказать пациенту, что он не прав",
        "Избегать излишнего подбадривания"
      ]
    },

    demonstrative: {
      name: "Проявленный",
      description: "Вы яркая и харизматичная личность, при этом вы можете быть достаточно чувствительны. Вы можете быть склонны к быстрой смене настроения",
      promise: "Я здесь с вами, чтобы поддержать вас и помочь вам на пути выздоровления",
      characteristics: [
        "Артистичны, харизматичны, характеризуются быстрой сменой настроения",
        "Эмоциональны"
      ],
      possible_actions: "Могут стараться впечатлить медперсонал как симптоматикой, так и в целом рассказывать истории",
      stress_factor: "Отсутствие внимания, проявление безразличия",
      stress_reaction: "Либо закрываются (испытывая стыд), либо включают демонстративное поведение",
      illness_perception: "Способ обратить на себя внимание, вызвать у окружающих жалость",
      treatment_perception: "Возможность произвести благоприятное впечатление и понравиться окружающим",
      voice_type: "Спокойный, мягкий, поддерживающий",
      interaction_frequency: "Средняя/высокая",
      positive_communication: [
        "Дозированная информация",
        "Больше акцент на границы взаимодействия",
        "Проявлять умеренный интерес, компенсировать объективностью данных",
        "Подчеркивать даже незначительные успехи",
        "Перенаправлять попытки контролировать в контроль своей жизни"
      ],
      negative_communication: [
        "Избегать споров и обесценивания",
        "Игнорирование жалоб",
        "Избыточный интерес и избыточное количество комплиментов"
      ]
    },

    excitable: {
      name: "Возбудимый",
      description: "Вы активны, способны быстро принимать решения, при этом эмоции могут вас захватывать, и выходить в форме раздражения на окружающих",
      promise: "И я здесь с вами, чтобы помочь вам лучше понять что с вами происходит и управлять собой",
      characteristics: [
        "Активны, гипервозбудимы, вспыльчивы",
        "Часто игнорируют общепринятые правила и нормы поведения",
        "Склонностью нарушать порядок, пренебрегать последствиями своих действий",
        "Невысокая степень ответственности"
      ],
      possible_actions: "Могут нарушать личные границы медперсонала, выплескивать гнев",
      stress_factor: "Препятствия на пути удовлетворения, долгое ожидание",
      stress_reaction: "Раздражение, агрессия на других",
      illness_perception: "Препятствие в удовлетворении потребностей и получении удовольствия",
      treatment_perception: "Возможность сопротивления и способ борьбы с болезнью",
      voice_type: "Средний темп речи, энергичный, устойчивый",
      interaction_frequency: "Средняя",
      positive_communication: [
        "Не перегружать информацией, действовать последовательно и предсказуемо",
        "Четко формулировать мысль без воды в случае проявления раздражения",
        "Возвращать ответственность и приглашать в совместное участие",
        "Фокусировать на плане лечения и наступлении эффекта"
      ],
      negative_communication: [
        "Избегать резких и категоричных и критичных высказываний",
        "Не стыдить",
        "Не угрожать и не принуждать"
      ]
    },

    cyclothymic: {
      name: "Цикличный",
      description: "Вы можете чувствовать себя то довольно бодро, то подавлено. Вам бывает сложно управлять своей жизнью из-за перемен в настроении и самочувствии",
      promise: "И я здесь с вами, чтобы помочь вам лучше понять что с вами происходит и управлять своей жизнью в разные периоды жизни",
      characteristics: [
        "Смена настроения от подъема (гипертимность) до легкой депрессии",
        "Непоследовательны, придирчивы к окружению",
        "В гипертимности: завышенная самооценка, несвязанная отрывистая речь, легкомыслие, склонность к эпатажу"
      ],
      possible_actions: "В фазе подъема могут чаще пропускать встречи или придираться к медперсоналу. В фазе спада низкая инициативность и потеря мотивации",
      stress_factor: "Необходимость жить в регламентированных условиях и сохранять стабильность",
      stress_reaction: "Повышенным энтузиазмом или утратой интересов и апатией",
      illness_perception: "В фазе подъема как случайное событие, в фазе спада как причина расстройства",
      treatment_perception: "В фазе подъема: необязательное занятие, в фазе спада: быть полезным близким",
      voice_type: "В фазе подъема: спокойный, устойчивый. В фазе спада: мягкий, поддерживающий",
      interaction_frequency: "В фазе подъема: средняя. В фазе спада: высокая",
      positive_communication: {
        up_phase: [
          "Предлагать пациенту почитать про способы лечения",
          "Признавать важность жить полной жизнью",
          "Хвалить за выполнение рекомендаций",
          "Активно подсвечивать риски невыполнения рекомендаций",
          "Активно вовлекать в процесс лечения"
        ],
        down_phase: [
          "Информация должна быть очень простой и дозированной",
          "Показать заинтересованность в понимании пациента",
          "Отмечать и позитивно подкреплять любые сдвиги",
          "Фокусировка на маленьких шагах",
          "Постоянная поддержка вместо активной мотивации"
        ]
      },
      negative_communication: [
        "В фазе подъема – слишком жесткой регламентации деятельности",
        "В фазе спада – принуждения и критики"
      ]
    },

    stuck: {
      name: "Фиксированный/Обидчивый",
      description: "Вы способны упорно идти к своей цели. При этом вы можете довольно долго проживать обиду и неудачи",
      promise: "Вы не одни на этом пути. Я поддержу вас, и помогу вам разобраться с тем, что вызывает напряжение и найти светлые моменты даже в сложных ситуациях.",
      characteristics: [
        "Продолжительно переживают негативные эмоции",
        "Имеют низкую адаптацию к изменениям",
        "Чувствительны к успехам других и собственным неудачам",
        "Часто застревают в чувстве зависти со знаком минус",
        "Имеют завышенные требования к себе и другим"
      ],
      possible_actions: "Конфликты",
      stress_factor: "Чередования успехов и неудач, успехи других, критика в свой адрес",
      stress_reaction: "Критикуют окружающих, желанием наказать и отомстить (черная зависть)",
      illness_perception: "Результат неблагоприятных внешних условий, неблагожелательных намерений или действий других людей или ошибок врачей",
      treatment_perception: "Восстановление справедливости и способ вызвать уважение со стороны окружающих",
      voice_type: "Энергичный, устойчивый, настойчивый",
      interaction_frequency: "Высокая",
      positive_communication: [
        "Принятие того, что пациент чувствует и помощь в осознании",
        "Если пациент выражает недоверие - показать готовность помочь",
        "Открытый диалог с называнием чувств и принятие того, что человек чувствует",
        "Отмечать реальными фактами без преувеличения то, что у пациента получилось хорошо"
      ],
      negative_communication: [
        "Избегать резких и категоричных и критичных высказываний",
        "Не стыдить",
        "Не давать советов"
      ]
    },

    pedantic: {
      name: "Педантичный",
      description: "Вы умеете быть человеком, на которого можно положиться. При этом Вам может быть сложно и напряженно в ситуациях неопределенности, что может вызывать затруднения в принятии решений.",
      promise: "Я помогу вам лучше понимать процесс лечения, а также поделюсь идеями как можно снимать напряжение - это поможет вам значительно облегчить путь лечения",
      characteristics: [
        "Неуверенностью в своих возможностях, сложности в принятии решения",
        "Стремлением «подстелить везде соломку»",
        "Живут довольно в высоком напряжении и склонны к выгоранию",
        "Гиперответственны и надежны"
      ],
      possible_actions: "Может очень формально подходить к встречам, выражать недовольство в случае нелогичности и непоследовательности действий",
      stress_factor: "Нарушение порядка, дефицит информации и времени, неопределенность",
      stress_reaction: "Начинают все контролировать, сопротивление изменениям",
      illness_perception: "Угрозу благополучию",
      treatment_perception: "Обязательное соблюдение правил и использование проверенных методов",
      voice_type: "Спокойный, медленный, поддерживающий",
      interaction_frequency: "Средняя",
      positive_communication: [
        "Информация должна быть полной и достоверной, с научной базой",
        "Последовательность и предсказуемость действий со стороны медперсонала",
        "Замечать его основательное отношение",
        "Уважать склонность к порядку, терпение в случае придирок"
      ],
      negative_communication: [
        "Избегать непроверенной информации",
        "Не запугивать",
        "Избегать нарушение порядка"
      ]
    },

    introverted: {
      name: "Интроверт",
      description: "Вы склонны к уединению. Вам может быть сложно понимать чувства других, а также затруднительно выражать свои",
      promise: "Я помогу вам найти способы для улучшения вашего состояния, относясь с уважением к вашему личному пространству",
      characteristics: [
        "Затруднениями в понимании окружающих и выражении своих чувств",
        "Интроверты, иногда выглядят как чудаки",
        "Очень много фантазируют внутри себя",
        "Обладают высоким интеллектом"
      ],
      possible_actions: "Малообщительны, избегают контакта и коммуникации",
      stress_factor: "Ситуации сокращения эмоционально и физической дистанции (например, частая коммуникация)",
      stress_reaction: "Закрываются от контакта, уходят в себя",
      illness_perception: "Событие, вызванное необычными причинами",
      treatment_perception: "Предпочтение использовать нестандартные способы, включая альтернативную медицину",
      voice_type: "Спокойный, устойчивый",
      interaction_frequency: "Низкая",
      positive_communication: [
        "Возможно лучший канал коммуникации для таких пациентов - это переписка",
        "Весь спектр активного слушания - повторение, резюмирование, задавание открытых вопросов",
        "Говорить коротко и ясно",
        "Оперировать фактами и достоверной информацией",
        "Активность коммуникации наращивать постепенно"
      ],
      negative_communication: [
        "Избегать напористости, критики, сильного подбадривания",
        "Активного сближения"
      ]
    },

    hyperthymic: {
      name: "Энергичный",
      description: "У вас часто хорошее настроение и вы настроены на активную работу, но вы можете переоценивать свои возможности",
      promise: "Я здесь с вами, чтобы поддержать вас и помочь лучше распределять ресурсы и направлять их на выздоровление",
      characteristics: [
        "Приподнятым настроением, оптимизмом, разнообразием интересов",
        "Большим количеством планов, переоценкой своих возможностей",
        "Повышенной отвлекаемостью, широкими и поверхностными контактами",
        "Низкий самоконтроль"
      ],
      possible_actions: "Возбуждены, могут спешить и от этого быть невнимательными, упускать важное, могут выражать панибратство",
      stress_factor: "Однообразие, ограничение свободы, осаживание, принуждение, запреты",
      stress_reaction: "Игнорируют риски и сложности, снимают с себя ответственность",
      illness_perception: "Недостойное внимания событие",
      treatment_perception: "Бессмысленное занятие, однако необходимое для изменения жизненных обстоятельств и собственного развития",
      voice_type: "Спокойный, устойчивый",
      interaction_frequency: "Средняя",
      positive_communication: [
        "Помогать держать фокус на том что важно обсудить на данной встрече",
        "Резюмировать то, что говорит пациент",
        "Подчеркивать сильные стороны пациента, хвалить за успехи",
        "Концентрироваться на позитивных аспектах лечения и выздоровления",
        "Основные принципы: открытый диалог при этом структурированный, поддержка позитивного настроя, заземление через обозначение чувств",
        "Поощрение ответственности и приглашение к участию в процессе лечения"
      ],
      negative_communication: [
        "Не принуждать, не давить, не требовать"
      ]
    }
  }
};

// Функция для получения инструкций по коммуникации на основе профилей
export function getCommunicationInstructions(attitudeProfile, typologyProfile) {
  const instructions = {
    general: {
      tone: "neutral",
      approach: "standard",
      key_points: [],
      avoid: [],
      seek: []
    },
    attitude: null,
    typology: null
  };

  // Добавляем инструкции по Attitude профилю
  if (attitudeProfile && attitudeProfile.scales) {
    const dominantScales = Object.entries(attitudeProfile.scales)
      .filter(([scale, score]) => {
        const threshold = attitudeProfile.thresholds[scale];
        if (!threshold) return false;
        return score >= threshold.high_min;
      })
      .sort(([,a], [,b]) => b - a)
      .slice(0, 2); // Берем 2 доминирующие шкалы

    if (dominantScales.length > 0) {
      const [scale, score] = dominantScales[0];
      const scaleInstructions = communicationInstructions.attitude[scale];
      if (scaleInstructions) {
        instructions.attitude = {
          name: scaleInstructions.name,
          description: scaleInstructions.description,
          communication_challenges: scaleInstructions.communication_challenges,
          positive_scenario: scaleInstructions.positive_scenario,
          negative_scenario: scaleInstructions.negative_scenario,
          extreme_actions: scaleInstructions.extreme_actions
        };

        // Обновляем общие инструкции
        if (scaleInstructions.positive_scenario) {
          instructions.general.key_points.push(...scaleInstructions.positive_scenario);
        }
        if (scaleInstructions.negative_scenario) {
          instructions.general.avoid.push(...scaleInstructions.negative_scenario);
        }
      }
    }
  }

  // Добавляем инструкции по Typology профилю
  if (typologyProfile && typologyProfile.dominant && typologyProfile.dominant.length > 0) {
    const dominantType = typologyProfile.dominant[0];
    const typeInstructions = communicationInstructions.typology[dominantType];
    if (typeInstructions) {
      instructions.typology = {
        name: typeInstructions.name,
        description: typeInstructions.description,
        promise: typeInstructions.promise,
        voice_type: typeInstructions.voice_type,
        interaction_frequency: typeInstructions.interaction_frequency,
        positive_communication: typeInstructions.positive_communication,
        negative_communication: typeInstructions.negative_communication
      };

      // Обновляем общие инструкции
      if (typeInstructions.positive_communication) {
        if (Array.isArray(typeInstructions.positive_communication)) {
          instructions.general.key_points.push(...typeInstructions.positive_communication);
        } else if (typeInstructions.positive_communication.up_phase && typeInstructions.positive_communication.down_phase) {
          // Для циклотимического типа добавляем инструкции для обеих фаз
          instructions.general.key_points.push(...typeInstructions.positive_communication.up_phase);
          instructions.general.key_points.push(...typeInstructions.positive_communication.down_phase);
        }
      }
      if (typeInstructions.negative_communication) {
        instructions.general.avoid.push(...typeInstructions.negative_communication);
      }

      // Обновляем тон и подход на основе типа
      if (typeInstructions.voice_type) {
        instructions.general.tone = typeInstructions.voice_type.split(',')[0].trim();
      }
      if (typeInstructions.interaction_frequency) {
        instructions.general.approach = typeInstructions.interaction_frequency;
      }
    }
  }

  return instructions;
}

// Функция для генерации персонализированного промпта для LLM
export function generatePersonalizedPrompt(instructions) {
  let prompt = "\n\n[ПЕРСОНАЛИЗАЦИЯ КОММУНИКАЦИИ]\n";
  
  if (instructions.attitude) {
    prompt += `\nПрофиль отношения к болезни: ${instructions.attitude.name}\n`;
    prompt += `Описание: ${instructions.attitude.description}\n`;
    prompt += `Основные сложности: ${instructions.attitude.communication_challenges.join(', ')}\n`;
  }

  if (instructions.typology) {
    prompt += `\nТипологический профиль: ${instructions.typology.name}\n`;
    prompt += `Описание: ${instructions.typology.description}\n`;
    prompt += `Обещание: ${instructions.typology.promise}\n`;
    prompt += `Тип голоса: ${instructions.typology.voice_type}\n`;
    prompt += `Частота взаимодействия: ${instructions.typology.interaction_frequency}\n`;
  }

  prompt += `\nКЛЮЧЕВЫЕ ПРИНЦИПЫ КОММУНИКАЦИИ:\n`;
  prompt += `✅ ЧТО ДЕЛАТЬ:\n`;
  instructions.general.key_points.forEach((point, index) => {
    prompt += `${index + 1}. ${point}\n`;
  });

  prompt += `\n❌ ЧЕГО ИЗБЕГАТЬ:\n`;
  instructions.general.avoid.forEach((point, index) => {
    prompt += `${index + 1}. ${point}\n`;
  });

  prompt += `\n🎯 ТОН КОММУНИКАЦИИ: ${instructions.general.tone}\n`;
  prompt += `📊 ПОДХОД: ${instructions.general.approach}\n`;

  return prompt;
}
