# Benehab Triage Demo

Веб-демо медицинского ассистента "Татьяна" с персонализированным подходом к коммуникации на основе психологических профилей.

## О проекте

**Татьяна** — медицинский ассистент, который:
- Ведет эмпатичный triage-диалог
- Дает справочную информацию о препаратах (без дозировок)
- Предлагает запись к врачу при необходимости
- Адаптирует тон общения на основе двух коротких опросов

## Особенности

- **Персонализация**: Адаптация тона общения на основе психологических профилей
- **Два опроса**: Отношение к болезни (41 вопрос) + Типологический профиль (56 вопросов)
- **9 шкал отношения к болезни**: severity, secondary_gain, hide_resist, work_escape, low_selfesteem, alt_med, addictions, ignore, anxiety
- **Обратные пункты**: Правильная обработка пунктов с reverse=true
- **PIB**: Patient Instruction Bundle для персонализации коммуникации
- **Чипы-интенты**: Быстрые действия для демонстрации адаптации
- **Автосохранение**: Прогресс опросов сохраняется автоматически
- **Страница результата**: Детальный анализ с risk tags и communication flags

## Технологии

- **Frontend**: Next.js 14, React 18, TailwindCSS
- **Backend**: Next.js API Routes
- **AI**: OpenAI GPT-4o-mini
- **Хранение**: localStorage (демо-режим)
- **Node.js**: 22.x

## Установка и запуск

### Предварительные требования

- Node.js 22.x
- OpenAI API ключ

### 1. Клонирование репозитория

```bash
git clone <repository-url>
cd benehab-triage-demo
```

### 2. Установка зависимостей

```bash
npm install
```

### 3. Настройка переменных окружения

Создайте файл `.env.local` в корне проекта:

```env
OPENAI_API_KEY=your_openai_api_key_here
```

### 4. Запуск в режиме разработки

```bash
npm run dev
```

Приложение будет доступно по адресу [http://localhost:3000](http://localhost:3000)

### 5. Сборка для продакшена

```bash
npm run build
npm start
```

## Структура проекта

```
benehab-triage-demo/
├── components/          # React компоненты
├── data/               # CSV файлы с данными опросов
├── lib/                # Библиотеки для расчета профилей
│   ├── profiling/      # Логика профилирования
│   └── pib.js         # Генерация PIB
├── pages/              # Next.js страницы
│   ├── api/            # API endpoints
│   │   └── profiling/  # API для опросов
│   ├── profiling/      # Страницы опросов
│   └── index.js        # Главная страница с чатом
└── styles/             # CSS стили
```

## Использование

### 1. Первый запуск

1. Откройте приложение
2. Введите возраст, рост, вес
3. Согласитесь на персонализацию

### 2. Прохождение опросов

#### Опрос A: Отношение к болезни (5-7 минут)
- 41 утверждение
- Ответы: 0 (не относится), 1 (частично), 2 (полностью)
- Автосохранение прогресса
- Батчи по 8 вопросов

#### Опрос B: Типологический профиль (3-5 минут)
- 56 утверждений в 8 категориях
- Ответы: чекбоксы (да/нет)
- Группировка по столбцам

### 3. Чат с персонализацией

После опросов:
- Чат адаптируется под ваш профиль
- Доступны чипы-интенты для демонстрации
- Отображается ваш PIB профиль

## API Endpoints

### Профилирование

- `GET /api/profiling/attitude/items` - Вопросы опроса A
- `POST /api/profiling/attitude/submit` - Отправка ответов A
- `GET /api/profiling/typology/items` - Вопросы опроса B
- `POST /api/profiling/typology/submit` - Отправка ответов B
- `POST /api/profiling/pib` - Генерация PIB

### Чат

- `POST /api/chat` - Основной чат с персонализацией

## Демо-данные

Проект включает демо-наборы данных:

- **attitude_items.csv**: 41 вопрос для опроса отношения к болезни
- **attitude_thresholds.csv**: Пороговые значения для 9 шкал
- **typology_items.csv**: 56 вопросов для типологического опроса
- **typology_thresholds.csv**: Пороги для определения доминирующих типов

## Развертывание на Vercel

1. Подключите репозиторий к Vercel
2. Установите переменную окружения `OPENAI_API_KEY`
3. Автодеплой при каждом push в main ветку

## Безопасность

- Демо-режим: данные не покидают браузер
- PII не передается в сторонние сервисы
- Ассистент не ставит диагнозы и не назначает лечение
- Только справочная информация + triage

## Разработка

### Добавление новых вопросов

1. Обновите соответствующий CSV файл в `data/`
2. При необходимости обновите логику расчета в `lib/profiling/`
3. Протестируйте через API endpoints

### Модификация PIB логики

1. Обновите `lib/pib.js`
2. Добавьте новые модификаторы в `buildPersonalizedPrompt()` в `pages/api/chat.js`

## Тестирование

### Unit тесты

```bash
# Добавьте тесты для lib/profiling/*.js
npm test
```

### E2E тестирование

1. Пройдите оба опроса
2. Проверьте генерацию PIB
3. Убедитесь в адаптации тона в чате
4. Протестируйте чипы-интенты

## Лицензия

Проект создан для демонстрации Benehab технологии персонализации медицинской коммуникации.

## Поддержка

По вопросам разработки и использования обращайтесь к команде Benehab.
